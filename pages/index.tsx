import type { NextPage } from 'next'
import { requestToBodyStream } from 'next/dist/server/body-streams'
import Head from 'next/head'
import { useState } from 'react'
import styles from '../styles/Home.module.css'

type Todo = {
  value: string;
  readonly id: number;
};

const Home: NextPage = () => {
  const [text,setText]=useState("");
  const [todos,setTodo]=useState<Todo[]>([]);


  const handleText=(e: React.ChangeEvent<HTMLInputElement>)=>{
    setText(e.target.value);
  }

  const inputText=(id:number,value:string)=>{
    const newTodo=todos.map((todo)=>({...todo}));
    const sinTodo=newTodo.map((todo)=>{
      if(todo.id===id){
        todo.value=value;
      }
      return todo;
    })

    setTodo(sinTodo);
  }

  const handleOnSubmit=()=>{
    if(text===""){
      return;
    }
    const newTask:Todo={
      value:text,
      id:new Date().getTime(),
    }
    setTodo([newTask,...todos]);
    setText('');
  }

  const handleDelete=(id:number)=>{
    const newTodo=todos.filter((todo)=>{
      return todo.id!=id;
    })

    setTodo(newTodo);
  }


  return (
    <div className={styles.container}>
      <Head>
        <title>TO DO アプリ</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h1>TODO App</h1>

        <form
            onSubmit={(e) => {
              e.preventDefault();
              handleOnSubmit();
            }}
          >
            <input
              type="text"
              value={text}
              onChange={(e) => handleText(e)}
            />
            <input type="submit" value="タスク追加" onSubmit={handleOnSubmit} />
          </form>
      <ol>
        {todos.map((todo)=>{
          return(
          <li key={todo.id}>
            <input type="text" value={todo.value} onChange={(e)=>inputText(todo.id,e.target.value)}/>
            <button onClick={()=>handleDelete(todo.id)}>削除</button>
          </li>
          )
        })}
      </ol>
    </div>
  )
}

export default Home
